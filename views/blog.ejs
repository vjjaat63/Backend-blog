<!DOCTYPE html>
<html lang="en">

<head>
    <%- include("./partials/head") %>
        <title><%= blog ? blog.title : 'Blog' %> - BlogIt</title>
</head>

<body>
    <%- include("./partials/nav") %>

    <% if (locals.blog) { %>
        <div class="main-container">
            <div class="blog-detail">
                <div class="blog-detail-header">
                    <h1 class="blog-detail-title"><%= blog.title %></h1>
                </div>
                
                <% if (blog.coverImageURL) { %>
                    <img src="<%= blog.coverImageURL %>" 
                         alt="Cover Image" 
                         class="blog-detail-image"
                         onerror="this.src='/images/default.jpg'">
                <% } %>
                
                <div class="blog-author">
                    <div class="author-info">
                        <% if (blog.createdBy && blog.createdBy.profileImageURL) { %>
                            <img src="<%= blog.createdBy.profileImageURL %>" 
                                 class="author-avatar-large" 
                                 alt="Author Avatar"
                                 onerror="this.src='/images/default.jpg'">
                        <% } %>
                        <span class="author-name">
                            <%= blog.createdBy ? blog.createdBy.fullName : 'Anonymous' %>
                        </span>
                    </div>
                </div>
                
                <div class="blog-detail-content"><%= blog.body %></div>
                
                <div class="comments-section">
                    <h2 class="comments-header">Comments (<%= Comments ? Comments.length : 0 %>)</h2>
                    
                    <% if (locals.user) { %>
                        <div class="comment-form">
                            <form action='/blog/comment/<%= blog._id %>' method="post">
                                <textarea name="content" 
                                          class="comment-input" 
                                          placeholder="Share your thoughts..." 
                                          rows="3" 
                                          required></textarea>
                                <button type="submit" class="btn-primary">Post Comment</button>
                            </form>
                        </div>
                    <% } else { %>
                        <div class="comment-form">
                            <p>Please <a href="/user/signin">sign in</a> to leave a comment.</p>
                        </div>
                    <% } %>
                    
                    <% if (locals.Comments && Comments.length > 0) { %>
                        <div class="comment-list">
                            <% Comments.forEach(comment => { %>
                                <div class="comment-item">
                                    <% if (comment.createdBy && comment.createdBy.profileImageURL) { %>
                                        <img src="<%= comment.createdBy.profileImageURL %>" 
                                             class="comment-avatar" 
                                             alt="Commenter Avatar"
                                             onerror="this.src='/images/default.jpg'">
                                    <% } else { %>
                                        <div class="comment-avatar" style="background: var(--bg-secondary); display: flex; align-items: center; justify-content: center; color: var(--text-secondary);">
                                            <i class="fas fa-user"></i>
                                        </div>
                                    <% } %>
                                    <div class="comment-content">
                                        <div class="comment-author">
                                            <%= comment.createdBy ? comment.createdBy.fullName : 'Anonymous' %>
                                        </div>
                                        <div class="comment-text">
                                            <%= comment.content %>
                                        </div>
                                    </div>
                                </div>
                            <% }) %>
                        </div>
                    <% } else { %>
                        <div class="empty-state">
                            <p>No comments yet. Be the first to share your thoughts!</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    <% } else { %>
        <div class="main-container">
            <div class="empty-state">
                <h3>Blog Not Found</h3>
                <p>The blog post you're looking for doesn't exist or has been removed.</p>
                <a href="/" class="btn-primary">Back to Home</a>
            </div>
        </div>
    <% } %>

    <%- include("./partials/script") %>
</body>

</html>